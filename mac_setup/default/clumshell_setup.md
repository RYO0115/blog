# 1. 在宅環境をアップグレードついでにMacbookのクラムシェル運用をできるようにしてみたよ

## 1. 概要

今回在宅環境をアップデートするついでに自宅でもMacbookを最大限活用できるように環境を整えたのでその説明をしていきます。

前半は購入したハードの説明と欠点、購入の際の注意事項を説明した後、後半にそのハード構成で実施したソフト側の設定などについて説明していきます。

## 2. 前置き 我が家でのMac vs Windows

Macbook Air M2を購入してから早1年ぐらい、外出の際の相棒としてよく持ち歩いているのですが、家にいるときはどうしても使用頻度が落ちていました。

理由は主に二つで、

- 部屋にはゲーミングPCがあり、こちらの環境がかなり整っていたため
- MacbookのM2チップはM1チップから引き続き、外部ディスプレイに接続できる台数が1台のみ

特に後者はディスプレイが2枚ないと作業したくない自分的には大きく、それが理由で使いずらいWindowsで我慢して作業していました。

せっかく20万オーバーのMacbookを買ったのにあまり使いこめていないのは勿体無いなーと思っていたのですが、そこそこ外出もしていたので少しモヤモヤしながらもこれまで過ごしていました。

## 3. 在宅環境の整備

そんな私ですが、最近業務内容が在宅がしやすい内容に変わってきたのもあり、在宅の頻度が上がってきました。

(元々ほぼフルリモートできる職場なのですが、組み込み系の開発を行っている関係で定期的に出社の必要がありました)

そこで今回のAmazonプライムデーで環境を整備しようと思い立ったわけです。

といっても環境はほとんど整っていました。

### 3.1. これまでのデスク環境

自分のデスク周りはこうなっていました。

image

ちなみに上の図の各ケーブルの種類は以下のようになっています。

image

機器の切替はUGREENの[USB切替器](https://amzn.to/3xUrykt)を使っていたので、ボタンひとつでパソコン間の切替ができていたのですが、いかんせん会社用PCを持ち出す、持ち込む度にType-CとHDMIの2本を繋ぎかえる必要がありました。

そこでドッキングステーションを追加することでType-C1本でまとめることにしました。

image

正直ここまでであればありふれたデスク環境を良くしました、というだけの今更な話なのですが、ここにMacbookも相乗りさせようとすると少し話は複雑になってきます。

次からMacbookにも使えるデスク環境を構築するために購入したものを紹介していきます。

(上の機器についても最後にリンクを貼っておきます。)

### 3.2. MacBook M2チップの制約. そしてDisplayLink

最初に書いた通り、M2チップのMacBookは外部ディスプレイに1枚しか出力できません。

しかし、実はこれには抜け穴があります。

それは[DisplayLink](https://www.synaptics.com/products/displaylink-graphics)という規格に対応したドッキングステーションを使用することです。

本来パソコンから映像を外部ディスプレイに出力しようと思うと、DisplayPort(以下DP)やHDMIといった画面出力用のポートを通してディスプレイに表示されます。

しかしこれだとパソコン側の画面出力の能力に依存してしまうため、Macbookなどでは1枚までしか出力できませんでした。

そこで登場するのがDisplayLinkです。

この規格は簡単にいうと、DPやHDMIなどの映像出力の信号をUSBに変換してくれるものになります。

つまりDisplayLink対応のドッキングステーションやUSB<->HDMI/DP変換器を使うと、パソコンから直接DPやHDMIに出力するのではなく、パソコンから一度USBを使った通信に変換された後にDisplayLinkのマネージャが改めてHDMI/DPに変換してディスプレイに送信してくれるのです。

そのためパソコン側に外部出力の能力が十分に無くても、DisplayLink対応の機器を使うことでより多くのディスプレイに出力できるようになるのです。

(だいたい2,3枚追加で表示できるようですが、自分は確認していません)

### 3.3. 購入したドッキングステーションの紹介

4年ほど前、MacbookがM1チップに移行した際にも調べたのですが、当時はDisplayLink対応機器が少なく、3,4万円していたのが、最近だと数が増えてきたのか1万円ちょっとで買えるようになっています。

そこで今回はAnkerの["Anker 564 USB C ドッキングステーション"](https://amzn.to/3Lqw6SL)を購入しました。

こちらは4K HDMI x 2ポート、4K DP x1　ポート対応しており、それぞれ最大60Hz出力できるモデルになります。

また表面には5GBps伝送対応のType-C,  USB-A 2.0 x 2, USB-A 3.2 Gen1 x 1とポートも必要十分

(本音では2.0は無しで全て3.2Gen1以上にして欲しいですが、どうせそこに接続するのはキーボードやマウスなので問題ないと判断)

最終的には私のデスク環境はこうなりました。

image

#### 3.3.1. 今回購入したドッキングステーションの欠点

今回購入したドッキングステーションの最大の欠点は巨大なACアダプタです。

本体とほぼ同サイズかつ倍以上の重さのACアダプタが別に接続する必要があります。

おそらくDisplayLinkを処理するためにそこそこの電力が必要だからだと思いますが、少しこれはいただけないですね。

今後購入される際はACアダプタのサイズなども情報を集めてから購入することをおすすめします。

#### 3.3.2. 実際の設置の様子

自分はディスプレイの上に[ライト付きの棚](https://amzn.to/3Y3aoeW)を設置しています。

なので今回はこのドッキングステーションをこの上に設置しました。

ACアダプタは大きすぎる + 重すぎるので机の後ろに転がしています。

image

image

もうすぐ引越し予定なので配線は綺麗にしていませんが、ディスプレイの上に置く分、HDMIケーブルなどをディスプレイの裏で完結できるので、配線なども綺麗になりそうな気がしています。

### 3.4. 在宅環境セットアップ完了

というわけでこのドッキングステーション導入により、ケーブル1本の抜き差しとボタン1つで

- ゲーミングPC
- Macbook
- 会社用ノートPC

の切替が可能なデスク環境が整いました。

しかしこれだけではMacを満足に使うことができません。

そこで次からはMacの中の設定を変えていきます。

## 4. Macbook設定変更

今回変更したのは主に以下です。

- DisplayLink Managerのインストール
- マウスのスクロール方向変更
- キーボードレイアウトの違いによるショートカットの変更

だいたいこの辺りを調整したところ、自分的に違和感のない操作感になりました。

ショートカットなどについては今後も調整した上で、改めて更新しようと思います。

### 4.1. DisplayLink Managerのインストール

3.2で説明した通り、DisplayLinkという規格を使用するには、ドッキングステーションとパソコンの間で映像出力をUSB経由でやり取りができる必要があります。

そのために[DisplayLink Manager](https://www.synaptics.com/products/displaylink-graphics/downloads)のダウンロードが必要になります。

やり方としてはリンク先のMac OS対応のインストーラのダウンロード、あとは続けると画面録画の権限を許可すれば完了です。

(画面録画の許可はDisplayLinkの挙動を監視するために必要なのだそう)

最後にDisplayLink Managerの操作画面を開き、Mac起動時に自動的に機動するにチェックを入れれば完了です。

どうしてもManager経由で反応が遅くなりますが、少し待つと外部ディスプレイ2枚目以降に接続されます。

### (ここから先はおまけ) マウスのスクロール方向変更

